---
title: 'OHI 2018 - Clean Water - Pathogen Pollution: Preparing Sanitation data'
author: "*Compiled on `r date()` by `r Sys.info()['user']`*"
output: 
  html_document:
    code_folding: show
    toc: true
    toc_depth: 1
    toc_float: yes
    number_sections: false
    theme: cerulean
    highlight: haddock
    includes: 
      in_header: '../../../src/templates/ohi_hdr.html'
pdf_document:
  toc: true
---

[REFERENCE RMD FILE:
]

# Summary
[general description: What data are being generated? Why (what project, etc.)? Upstream/downstream processing information that might be helpful?  Other information?]

This document describes the steps for wrangling the data for the pathogen pollution and pathogen pollution trend data layers for the 2018 global assessment.

# Updates from previous assessment
Data source (WHO-UNICEF) updated the way they reported the data. However, the 2018 assesment is calculated using the "At least Basic" data becuse it is consistent with what have been used in previous assesmentes and it is more complete. 
Consider for future assesments: make the "Safely managed" data more complete, and reconsider whether these data would be better to use.

Deffinition of each variable according to the data source:
"At leasr basic": Use of improved facilities that are not shared with other households.

"Safely managed": Use of improved facilities that are not shared with other households and where excreta are safely disposed of in situ or transported and treated offsite

***

# Data Source [NOTE: can be copied from README.md in rawdata file]
**Reference**: 
            https://washdata.org/data
            Updated July 2017

**Downloaded**: Downloaded 5/1/2018

**Description**:  Percentage of the population that has access to improved facilities that are not shared with other households (At a basic level).

Access to improved sanitation facilities is defined as the percentage of the population within a country with at least adequate access to excreta disposal facilities that can effectively prevent human, animal, and insect contact with excreta.

**Native data resolution**: country-wide average (not specific to the coastal region)

**Time range**: 2000 - 2015

**Format**:  csv saved in git_annex in Mazu

***
  
# Methods
[R code used to generate the data. Or, alternatively, description of the code/data files used to generate the data.]

Percentages (0-100) for each country were rescaled to 0-1 based on a maximum target of 100% of the population with access to improved sanitation, and a minimum value of 0.

***

# Citation information  
[citation information: include if these data will have their own specific citation.]


#Setup

```{r}
##Packages
library(ohicore) # devtools::install_github('ohi-science/ohicore') # may require uninstall and reinstall
library(zoo)     # for na.locf: Last Observation Carried Forward

#Sources to be able to read data???
source('src/R/common.R')
source('https://raw.githubusercontent.com/OHI-Science/ohiprep_v2018/master/src/R/common.R')
source('src/R/ohi_clean_fxns.R') # has functions: cbind_rgn(), sum_na()
```

#Import Raw data

```{r}
##Build file path
goal     <- 'ohiprep_v2018/prs_cw_pathogen/v2018' #make sure it reflects the year of the assessment
scenario <- 'v2018'
dir_git  <- file.path('~/github/ohiprep_v2018', goal)
dir_data <- file.path(dir_M, 'git-annex/globalprep/_raw_data/WHO_UNICEF/d2018/')
dir_int  <- file.path(dir_git, scenario, 'int')


sani_raw <- read.csv('https://raw.githubusercontent.com/OHI-Science/ohiprep_v2018/master/globalprep/prs_cw_pathogen/v2018/raw/JMP_2017_WLD.csv',  header = FALSE, sep = ",", na.strings = c(NA, ''), skip = 2, stringsAsFactors = FALSE) 

```
#Data wrangling
Selecting and naming the columns of interest
```{r}
sani <- sani_raw %>%
  select(country = V1,
         year = V3,
         pop = V4,
         basic = V6)

#          imp_tot_ct     = Total.Improved..x1000. ,
#          imp_tot_pct    = Total.Improved.... ,
#          unimp_tot_ct   = Total.Unimproved..x1000. ,
#          unimp_tot_pct  = Total.Unimproved....) %>%
#   mutate(pop            = pop          * 1000,
#          imp_tot_ct     = imp_tot_ct   * 1000,
#          unimp_tot_ct   = unimp_tot_ct * 1000,
#          country        = na.locf(country))      # use na.locf() function from zoo package to fill down for country names

```









